---
import Layout from '@/layouts/Layout.astro'
import FormInput from '@/components/FormInput.astro'
---

<Layout
	title="Nueva Nota"
	actionBar
>
	<main class="w-full max-w-5xl text-primary text-lg">
		<form class="flex flex-col w-full bg-background rounded-lg px-6">
			<FormInput
				class="text-2xl font-bold text-accent"
				name="title"
				placeholder="TÃ­tulo"
			/>

			<FormInput
				class="w-full text-pretty text-lg my-4 text-accent"
				name="content"
				type="textarea"
				placeholder="Nota"
				autocapitalize="sentences"
			/>
		</form>
	</main>
</Layout>

<script>
	document.addEventListener('astro:page-load', () => {
		const back = document.querySelector(`#back-btn`)
		const form = document.querySelector(`form`) as HTMLFormElement

		const saveNote = async () => {
			const formData = new FormData(form)
			const data = Object.fromEntries(formData)

			const response = await window.fetch('/api/notes', {
				method: 'POST',
				body: JSON.stringify(data),
				headers: {
					'Content-Type': `application/json`,
				},
			})
			if (response.ok) {
				console.log(`response ok`)
				window.location.href = `/`
			} else {
				console.error(`Error:`, response)
			}
		}

		back?.addEventListener(`click`, async () => {
			await saveNote()
			window.history.back()
		})

		form?.addEventListener(`submit`, async (e) => {
			e.preventDefault()
			await saveNote()
		})
	})
</script>
